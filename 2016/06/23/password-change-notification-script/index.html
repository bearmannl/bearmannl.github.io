<!DOCTYPE html>
<html lang="en-us">

<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <meta property="og:title" content=" Password Change Notification Script &middot;  Bearman.NL" />
  
  <meta property="og:site_name" content="Bearman.NL" />
  <meta property="og:url" content="https://bearman.nl/2016/06/23/password-change-notification-script/" />
  
  
  <meta property="og:type" content="article" />
  
  <meta property="og:article:published_time" content="2016-06-23T14:09:50&#43;02:00" />
  
  <meta property="og:article:tag" content="active-directory" />
  
  <meta property="og:article:tag" content="ad" />
  
  <meta property="og:article:tag" content="email" />
  
  <meta property="og:article:tag" content="expiration" />
  
  <meta property="og:article:tag" content="notification" />
  
  <meta property="og:article:tag" content="password" />
  
  <meta property="og:article:tag" content="powershell" />
  
  <meta property="og:article:tag" content="script" />
  
  

  <title>
     Password Change Notification Script &middot;  Bearman.NL
  </title>

  <link rel="stylesheet" href="https://bearman.nl/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://bearman.nl/css/main.css" />
  <link rel="stylesheet" href="https://bearman.nl/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://bearman.nl/css/github.css" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400" type="text/css">
  <link rel="shortcut icon" href="https://bearman.nl/images/favicon.ico" />
  <link rel="apple-touch-icon" href="https://bearman.nl/images/apple-touch-icon.png" />
  
</head>

<body>
  <header class="global-header"
    style="background-image:url( /images/bg.jpg )">
    <section class="header-text">
      <h1><a href="https://bearman.nl/">Bearman.NL</a></h1>
      
      <div class="sns-links hidden-print">
  
  
  
  
  
  
  
  
  
  
  
  
</div>
      
      <a href="https://bearman.nl/" class="btn-header btn-back hidden-xs">
        <i class="fa fa-angle-left" aria-hidden="true"></i>
        &nbsp;Home
      </a>
      
      
    </section>
  </header>
  <main class="container">

<article>
  <header>
    <h1 class="text-primary">Password Change Notification Script</h1>
    <div class="post-meta clearfix">
      
      <div class="post-date pull-left">
        Posted on
        <time datetime="2016-06-23T14:09:50&#43;02:00">
          Jun 23, 2016
        </time>
      </div>
      
      <div class="pull-right">
        
        <span class="post-tag small"><a href="https://bearman.nl//tags/active-directory">#active-directory</a></span>
        
        <span class="post-tag small"><a href="https://bearman.nl//tags/ad">#ad</a></span>
        
        <span class="post-tag small"><a href="https://bearman.nl//tags/email">#email</a></span>
        
        <span class="post-tag small"><a href="https://bearman.nl//tags/expiration">#expiration</a></span>
        
        <span class="post-tag small"><a href="https://bearman.nl//tags/notification">#notification</a></span>
        
        <span class="post-tag small"><a href="https://bearman.nl//tags/password">#password</a></span>
        
        <span class="post-tag small"><a href="https://bearman.nl//tags/powershell">#powershell</a></span>
        
        <span class="post-tag small"><a href="https://bearman.nl//tags/script">#script</a></span>
        
      </div>
    </div>
  </header>
  <section>
    <article class="blog-post content-item">

    <h1>Version 1.4</h1>
<p>Recently I found myself in need of a password change notification script. What do all efficient/lazy administrators do when they need a script for any purpose? Right, I searched one online, downloaded it, <em>checked it</em>, suppressed any desire to fiddle with it and then scheduled it to run. For those interested, I used the script provided by Robert Pearman <a href="https://gallery.technet.microsoft.com/Password-Expiry-Email-177c3e27"><span style="text-decoration: underline;">over at the Technet Gallery</span></a>. For Office365 compatibility check <a href="https://windowsserveressentials.com/2015/01/23/office-365-email-password-reminder/"><span style="text-decoration: underline;">his post here</span></a>…</p>

<h1>Version 2.0</h1>
<p>But then… that annoying little Mutant-OCD gene (those of you who have it surely recognize it!) crept up on me today and I started fiddling with it anyway. I told myself the script needed to include some customizations for my company, but who am I kidding, I would lose sleep if I didn’t give in to my OCD quirks every once in a while. In general, I changed the script to include a proper description block, parameters, cleanup of casing for variables and refactoring of some Boolean uses to shorten the if statements. The part I needed to change specifically for Silverside was the Filter for the Get-ADUser command, this allows me to filter out Admin accounts in our organization:
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#960050;background-color:#1e0010">…</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">and</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">_</span>.<span style="color:#a6e22e">UserPrincipalName</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">notlike</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">adm</span><span style="color:#f92672">*</span><span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#960050;background-color:#1e0010">…</span></code></pre></td></tr></table>
</div>
</div>

Overall the script is now easier to deploy out of the box with the use of parameters (including defaults), so long as you remember to adjust <strong><em><strong>at least</strong></em></strong> the <strong>$smtpServer</strong> and <strong>$from</strong> variables under the config section:
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">smtpServer</span> = <span style="color:#e6db74">&#34;mail.yourdomain.local&#34;</span>
<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">from</span> = <span style="color:#e6db74">&#34;Your Company IT noreply@yourdomain.com&#34;</span></code></pre></td></tr></table>
</div>
</div>
</p>

<h1>The script</h1>
<p>As you no doubt found this post after efficiently searching for a free scipt online, feel free to use, I hope it saves you some time. Just remember to include the original author as described in the comments. You can also find the latest version at my GitHub account,&nbsp;<a href="https://github.com/bearmannl/posh/blob/master/Scripts/Send-PasswordChangeNotification.ps1">Send-PasswordChangeNotification.ps1</a> 
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">&lt;<span style="color:#960050;background-color:#1e0010">#</span>
.<span style="color:#a6e22e">SYNOPSIS</span>
    <span style="color:#a6e22e">Get</span> <span style="color:#a6e22e">all</span> <span style="color:#a6e22e">users</span> <span style="color:#a6e22e">with</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">soon</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">expire</span> <span style="color:#a6e22e">password</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">send</span> <span style="color:#a6e22e">them</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">reminder</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">do</span> <span style="color:#a6e22e">so</span>.

.<span style="color:#a6e22e">DESCRIPTION</span>
    <span style="color:#a6e22e">This</span> <span style="color:#a6e22e">script</span> <span style="color:#a6e22e">gets</span> <span style="color:#a6e22e">all</span> <span style="color:#a6e22e">users</span> <span style="color:#a6e22e">with</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">soon</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">expire</span> <span style="color:#a6e22e">password</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">sends</span> <span style="color:#a6e22e">them</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">reminder</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">do</span> <span style="color:#a6e22e">so</span>. <span style="color:#a6e22e">This</span> <span style="color:#a6e22e">script</span> <span style="color:#a6e22e">was</span> <span style="color:#a6e22e">originally</span> <span style="color:#a6e22e">created</span> <span style="color:#a6e22e">by</span> <span style="color:#a6e22e">Robert</span> <span style="color:#a6e22e">Pearman</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">posted</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">technet</span> <span style="color:#a6e22e">gallery</span>. <span style="color:#a6e22e">Since</span> <span style="color:#a6e22e">modified</span> <span style="color:#a6e22e">by</span> <span style="color:#a6e22e">Mike</span> <span style="color:#a6e22e">Beerman</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">include</span> <span style="color:#a6e22e">changes</span> <span style="color:#a6e22e">specific</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">Silverside</span>. <span style="color:#a6e22e">Settings</span> <span style="color:#a6e22e">such</span> <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">destination</span> <span style="color:#a6e22e">SMTP</span> <span style="color:#a6e22e">server</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">From</span> <span style="color:#a6e22e">address</span> <span style="color:#a6e22e">can</span> <span style="color:#a6e22e">only</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">configured</span> <span style="color:#a6e22e">within</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">script</span>.

.<span style="color:#a6e22e">PARAMETER</span> <span style="color:#a6e22e">ExpireInDays</span>
    <span style="color:#a6e22e">Optional</span> <span style="color:#a6e22e">input</span> <span style="color:#a6e22e">allowing</span> <span style="color:#a6e22e">an</span> <span style="color:#a6e22e">override</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">number</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">days</span> <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">which</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">script</span> <span style="color:#a6e22e">will</span> <span style="color:#a6e22e">send</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">reminder</span>. <span style="color:#a6e22e">Defaults</span> <span style="color:#a6e22e">to</span> <span style="color:#ae81ff">30</span> <span style="color:#a6e22e">days</span>.

.<span style="color:#a6e22e">PARAMETER</span> <span style="color:#a6e22e">Logging</span>
    <span style="color:#a6e22e">Switch</span> <span style="color:#a6e22e">which</span> <span style="color:#a6e22e">determines</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">seperate</span> <span style="color:#a6e22e">CSV</span> <span style="color:#a6e22e">logfile</span> <span style="color:#a6e22e">should</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">created</span>. <span style="color:#a6e22e">Default</span> <span style="color:#a6e22e">to</span> <span style="color:#66d9ef">false</span> <span style="color:#a6e22e">without</span> <span style="color:#a6e22e">the</span> <span style="color:#66d9ef">switch</span>.

.<span style="color:#a6e22e">PARAMETER</span> <span style="color:#a6e22e">LogPath</span>
    <span style="color:#a6e22e">Folderpath</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">logfile</span>, <span style="color:#a6e22e">plain</span> <span style="color:#66d9ef">string</span> <span style="color:#a6e22e">format</span>.

.<span style="color:#a6e22e">PARAMETER</span> <span style="color:#a6e22e">Testing</span>
    <span style="color:#a6e22e">Switch</span> <span style="color:#a6e22e">which</span> <span style="color:#a6e22e">determines</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">emails</span> <span style="color:#a6e22e">should</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">sent</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">test</span> <span style="color:#a6e22e">recipient</span> <span style="color:#a6e22e">instead</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">actual</span> <span style="color:#a6e22e">users</span>. <span style="color:#a6e22e">Default</span> <span style="color:#a6e22e">to</span> <span style="color:#66d9ef">false</span> <span style="color:#a6e22e">without</span> <span style="color:#a6e22e">the</span> <span style="color:#66d9ef">switch</span>.

.<span style="color:#a6e22e">PARAMETER</span> <span style="color:#a6e22e">TestRecipient</span>
    <span style="color:#a6e22e">Optional</span> <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">setting</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">different</span> <span style="color:#a6e22e">recipient</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">testing</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">testing</span> <span style="color:#a6e22e">purposes</span>. <span style="color:#a6e22e">Will</span> <span style="color:#a6e22e">not</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">used</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">Testing</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">not</span> <span style="color:#a6e22e">included</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">command</span> <span style="color:#a6e22e">or</span> <span style="color:#a6e22e">email</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">disabled</span>.

.<span style="color:#a6e22e">PARAMETER</span> <span style="color:#a6e22e">TestMailDisabled</span>
    <span style="color:#a6e22e">Switch</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">disabling</span> <span style="color:#a6e22e">email</span> <span style="color:#a6e22e">functionality</span>.

.<span style="color:#a6e22e">EXAMPLE</span>
<span style="color:#a6e22e">Send</span><span style="color:#f92672">-</span><span style="color:#a6e22e">PasswordChangeNotification</span>.<span style="color:#a6e22e">ps1</span>
<span style="color:#a6e22e">Send</span><span style="color:#f92672">-</span><span style="color:#a6e22e">PasswordChangeNotification</span>.<span style="color:#a6e22e">ps1</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">Expire</span> <span style="color:#ae81ff">60</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">Logging</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">Logile</span> <span style="color:#e6db74">&#34;C:\Logs\PasswordChangeNotifications.csv&#34;</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">Testing</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">TestRecipient</span> <span style="color:#e6db74">&#34;yourname@yourdomain.com&#34;</span>

.<span style="color:#a6e22e">LINK</span>
    <span style="color:#a6e22e">https</span>:<span style="color:#75715e">//gallery.technet.microsoft.com/Password-Expiry-Email-177c3e27
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">http</span>:<span style="color:#75715e">//bearman.nl/2016/06/23/password-change-notification-script
</span><span style="color:#75715e"></span>
.<span style="color:#a6e22e">NOTES</span>
    <span style="color:#a6e22e">Authors</span> : <span style="color:#a6e22e">Mike</span> <span style="color:#a6e22e">Beerman</span>
    <span style="color:#a6e22e">Company</span> : <span style="color:#a6e22e">Silverside</span>
    <span style="color:#a6e22e">Date</span> : <span style="color:#ae81ff">2016</span><span style="color:#f92672">-</span><span style="color:#ae81ff">06</span><span style="color:#f92672">-</span><span style="color:#ae81ff">23</span>
    <span style="color:#a6e22e">Version</span> : <span style="color:#ae81ff">2.0</span>

    <span style="color:#a6e22e">Authors</span> : <span style="color:#a6e22e">Robert</span> <span style="color:#a6e22e">Pearman</span> (<span style="color:#a6e22e">WSSMB</span> <span style="color:#a6e22e">MVP</span>)
    <span style="color:#a6e22e">Company</span> : <span style="color:#a6e22e">Windows</span> <span style="color:#a6e22e">Server</span> <span style="color:#a6e22e">Essentials</span>
    <span style="color:#a6e22e">Date</span> : <span style="color:#ae81ff">2016</span><span style="color:#f92672">-</span><span style="color:#ae81ff">02</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span>
    <span style="color:#a6e22e">Version</span> : <span style="color:#ae81ff">1.4</span>
<span style="color:#960050;background-color:#1e0010">#</span>&gt;

<span style="color:#a6e22e">param</span> (
    [<span style="color:#a6e22e">ValidateRange</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">365</span>)][<span style="color:#66d9ef">int</span>]<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">ExpireInDays</span> = <span style="color:#ae81ff">30</span>,
    [<span style="color:#66d9ef">switch</span>]<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">Logging</span>,
    [<span style="color:#66d9ef">string</span>]<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">LogPath</span> = <span style="color:#e6db74">&#34;C:\Logs&#34;</span>,
    [<span style="color:#66d9ef">switch</span>]<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">Testing</span>,
    [<span style="color:#66d9ef">string</span>]<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">TestRecipient</span> = <span style="color:#e6db74">&#34;yourname@yourdomain.com&#34;</span>,
    [<span style="color:#66d9ef">switch</span>]<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">TestMailDisabled</span>
)

<span style="color:#960050;background-color:#1e0010">##</span>
<span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">Config</span> <span style="color:#a6e22e">values</span>
<span style="color:#960050;background-color:#1e0010">##</span>

<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">smtpServer</span> = <span style="color:#e6db74">&#34;mail.yourdomain.local&#34;</span>
<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">from</span> = <span style="color:#e6db74">&#34;Your Company IT &lt;noreply@yourdomain.com&gt;&#34;</span>
<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">textEncoding</span> = [<span style="color:#a6e22e">System</span>.<span style="color:#a6e22e">Text</span>.<span style="color:#a6e22e">Encoding</span>]::<span style="color:#a6e22e">UTF8</span>
<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">logDate</span> = <span style="color:#a6e22e">Get</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Date</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">Format</span> <span style="color:#a6e22e">yyyyMMdd</span>
<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">LogPath</span> = (<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">LogPath</span>).<span style="color:#a6e22e">TrimEnd</span>(<span style="color:#e6db74">&#34;\&#34;)
</span><span style="color:#e6db74">$logFile = $LogPath + &#34;</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">PasswordChangeNotifications</span>.<span style="color:#a6e22e">csv</span><span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">##
</span><span style="color:#e6db74">#Initiate PowerShell session
</span><span style="color:#e6db74">##
</span><span style="color:#e6db74">
</span><span style="color:#e6db74"># Set threading
</span><span style="color:#e6db74">$ver = $host | Select-Object Version
</span><span style="color:#e6db74">if($ver.Version.Major -gt 1) {$Host.Runspace.ThreadOptions = &#34;</span><span style="color:#a6e22e">ReuseThread</span><span style="color:#e6db74">&#34;}
</span><span style="color:#e6db74">
</span><span style="color:#e6db74"># Load Active Directory PowerShell snap-in
</span><span style="color:#e6db74">Import-Module ActiveDirectory
</span><span style="color:#e6db74">Write-Verbose (&#34;</span>[{<span style="color:#ae81ff">0</span>}] <span style="color:#f92672">-</span> <span style="color:#a6e22e">AD</span> <span style="color:#a6e22e">PowerShell</span> <span style="color:#a6e22e">SnapIn</span> <span style="color:#a6e22e">loaded</span><span style="color:#e6db74">&#34; -f (Get-Date -Format T))
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">$verbosePreference = &#39;Continue&#39;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74"># Check Logging Settings
</span><span style="color:#e6db74">if ($Logging) {
</span><span style="color:#e6db74">    # Test Log Folder Path and create new directory if false
</span><span style="color:#e6db74">    if ($null -eq (Test-Path $LogPath)) {
</span><span style="color:#e6db74">        # Create CSV File and Headers
</span><span style="color:#e6db74">        New-Item $LogPath -ItemType Directory | Out-Null
</span><span style="color:#e6db74">        Write-Verbose (&#34;</span>[{<span style="color:#ae81ff">0</span>}] <span style="color:#f92672">-</span> <span style="color:#a6e22e">New</span> <span style="color:#a6e22e">folder</span> <span style="color:#a6e22e">created</span> <span style="color:#a6e22e">at</span> [{<span style="color:#ae81ff">1</span>}]<span style="color:#e6db74">&#34; -f (Get-Date -Format T), $LogPath)
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">    # Test Log File Path and create new file if false
</span><span style="color:#e6db74">    if ($null -eq (Test-Path $logFile)) {
</span><span style="color:#e6db74">        # Create CSV File and Headers
</span><span style="color:#e6db74">        New-Item $logFile -ItemType File | Out-Null
</span><span style="color:#e6db74">        Add-Content $logFile &#34;</span><span style="color:#a6e22e">Date</span>,<span style="color:#a6e22e">Name</span>,<span style="color:#a6e22e">EmailAddress</span>,<span style="color:#a6e22e">DaystoExpire</span>,<span style="color:#a6e22e">ExpiresOn</span>,<span style="color:#a6e22e">Notified</span><span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">        Write-Verbose (&#34;</span>[{<span style="color:#ae81ff">0</span>}] <span style="color:#f92672">-</span> <span style="color:#a6e22e">New</span> <span style="color:#a6e22e">logfile</span> <span style="color:#a6e22e">created</span> <span style="color:#a6e22e">at</span> [{<span style="color:#ae81ff">1</span>}]<span style="color:#e6db74">&#34; -f (Get-Date -Format T), $logFile)
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">} # End Logging Check
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">$DefaultmaxPasswordAge = (Get-ADDefaultDomainPasswordPolicy).MaxPasswordAge
</span><span style="color:#e6db74">
</span><span style="color:#e6db74"># Get Users From AD who are Enabled, Passwords Expire and are Not Currently Expired
</span><span style="color:#e6db74">$users = Get-ADUser -Filter * -Properties Name, PasswordNeverExpires, PasswordExpired, PasswordLastSet, EmailAddress | Where-Object { $_.Enabled -eq $true -and $_.PasswordNeverExpires -eq $false -and $_.passwordexpired -eq $false -and $_.UserPrincipalName -notlike &#39;adm*&#39; }
</span><span style="color:#e6db74">
</span><span style="color:#e6db74"># Process Each User for Password Expiry
</span><span style="color:#e6db74">foreach ($user in $users) {
</span><span style="color:#e6db74">    $name = $user.Name
</span><span style="color:#e6db74">    $emailAddress = $user.EmailAddress
</span><span style="color:#e6db74">    $passwordSetDate = $user.PasswordLastSet
</span><span style="color:#e6db74">    $PasswordPol = (Get-ADUserResultantPasswordPolicy $user)
</span><span style="color:#e6db74">    $sent = &#34;&#34; # Reset Sent Flag
</span><span style="color:#e6db74">    # Check for Fine Grained Password
</span><span style="color:#e6db74">    if ($null -ne ($PasswordPol)) {
</span><span style="color:#e6db74">        $maxPasswordAge = ($PasswordPol).MaxPasswordAge
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">    else {
</span><span style="color:#e6db74">        # No FGP set to Domain Default
</span><span style="color:#e6db74">        $maxPasswordAge = $DefaultmaxPasswordAge
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    $expiresOn = $passwordSetDate + $maxPasswordAge
</span><span style="color:#e6db74">    $today = (Get-Date)
</span><span style="color:#e6db74">    $daysToExpire = (New-TimeSpan -Start $today -End $expiresOn).Days
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    # Set Greeting based on Number of Days to Expiry.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    # Check Number of Days to Expiry
</span><span style="color:#e6db74">    $messageDays = $daysToExpire
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    if (($messageDays) -gt &#34;</span><span style="color:#ae81ff">1</span><span style="color:#e6db74">&#34;) {
</span><span style="color:#e6db74">        $messageDays = &#34;</span><span style="color:#a6e22e">in</span> <span style="color:#e6db74">&#34; + &#34;</span><span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">daysToExpire</span><span style="color:#e6db74">&#34; + &#34;</span> <span style="color:#a6e22e">days</span>.<span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">    else {
</span><span style="color:#e6db74">        $messageDays = &#34;</span><span style="color:#a6e22e">today</span>.<span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    # Email Subject Set Here
</span><span style="color:#e6db74">    $subject=&#34;</span><span style="color:#a6e22e">Your</span> <span style="color:#a6e22e">password</span> <span style="color:#a6e22e">will</span> <span style="color:#a6e22e">expire</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">messageDays</span><span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    # Email Body Set Here, Note You can use HTML, including Images.
</span><span style="color:#e6db74">    $body =&#34;</span>
    <span style="color:#a6e22e">Dear</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">name</span>,
    &lt;<span style="color:#a6e22e">p</span>&gt; <span style="color:#a6e22e">Your</span> <span style="color:#a6e22e">Password</span> <span style="color:#a6e22e">will</span> <span style="color:#a6e22e">expire</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">messageDays</span>&lt;<span style="color:#a6e22e">br</span>&gt;
    <span style="color:#a6e22e">To</span> <span style="color:#a6e22e">change</span> <span style="color:#a6e22e">your</span> <span style="color:#a6e22e">password</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">PC</span> <span style="color:#a6e22e">press</span> <span style="color:#a6e22e">CTRL</span> <span style="color:#a6e22e">ALT</span> <span style="color:#a6e22e">Delete</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">choose</span> <span style="color:#a6e22e">Change</span> <span style="color:#a6e22e">Password</span> &lt;<span style="color:#a6e22e">br</span>&gt;
    &lt;<span style="color:#a6e22e">p</span>&gt;<span style="color:#a6e22e">Thanks</span>, &lt;<span style="color:#a6e22e">br</span>&gt; 
    <span style="color:#a6e22e">Your</span> <span style="color:#a6e22e">Comany</span> <span style="color:#a6e22e">IT</span> <span style="color:#a6e22e">Administrators</span>
    &lt;<span style="color:#f92672">/</span><span style="color:#a6e22e">P</span>&gt;<span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    # If Testing Is Enabled - Email Administrator
</span><span style="color:#e6db74">    if ($Testing) {
</span><span style="color:#e6db74">        $emailAddress = $TestRecipient
</span><span style="color:#e6db74">    } # End Testing
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    # If a user has no email address listed
</span><span style="color:#e6db74">    if ($null -eq ($emailAddress)) {
</span><span style="color:#e6db74">        $emailAddress = $TestRecipient 
</span><span style="color:#e6db74">    }# End No Valid Email
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    # Send Email Message
</span><span style="color:#e6db74">    if (($daysToExpire -eq &#39;0&#39;) -or ($daysToExpire -eq &#39;14&#39;) -or ($daysToExpire -eq $ExpireInDays)) {
</span><span style="color:#e6db74">        $sent = &#34;</span><span style="color:#a6e22e">Yes</span><span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">        # If Logging is Enabled Log Details
</span><span style="color:#e6db74">        if ($Logging) {
</span><span style="color:#e6db74">            Add-Content $logFile &#34;</span><span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">logDate</span>,<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">name</span>,<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">emailAddress</span>,<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">daysToExpire</span>,<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">expiresOn</span>,<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">sent</span><span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">            Write-Verbose (&#34;</span>[{<span style="color:#ae81ff">0</span>}] <span style="color:#f92672">-</span> <span style="color:#a6e22e">Entry</span> <span style="color:#a6e22e">added</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">logfile</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">user</span> [{<span style="color:#ae81ff">1</span>}]<span style="color:#e6db74">&#34; -f (Get-Date -Format T), $user.UserPrincipalName)
</span><span style="color:#e6db74">        }
</span><span style="color:#e6db74">        # Send Email Message if not disabled by switch
</span><span style="color:#e6db74">        if ($null -eq ($TestMailDisabled)) {
</span><span style="color:#e6db74">            Send-Mailmessage -SmtpServer $smtpServer -From $from -To $emailAddress -Subject $subject -Body $body -BodyAsHTML -Priority High -Encoding $textEncoding
</span><span style="color:#e6db74">            Write-Verbose (&#34;</span>[{<span style="color:#ae81ff">0</span>}] <span style="color:#f92672">-</span> <span style="color:#a6e22e">Email</span> <span style="color:#a6e22e">sent</span> <span style="color:#a6e22e">to</span> [{<span style="color:#ae81ff">1</span>}]<span style="color:#e6db74">&#34; -f (Get-Date -Format T), $emailAddress)
</span><span style="color:#e6db74">        }
</span><span style="color:#e6db74">    } # End Send Message
</span><span style="color:#e6db74">    else {
</span><span style="color:#e6db74">        # Log Non Expiring Password
</span><span style="color:#e6db74">        $sent = &#34;</span><span style="color:#a6e22e">No</span><span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">        # If Logging is Enabled Log Details
</span><span style="color:#e6db74">        if ($Logging) {
</span><span style="color:#e6db74">            Add-Content $logFile &#34;</span><span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">logDate</span>,<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">name</span>,<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">emailAddress</span>,<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">daysToExpire</span>,<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">expiresOn</span>,<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">sent</span><span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">            Write-Verbose (&#34;</span>[{<span style="color:#ae81ff">0</span>}] <span style="color:#f92672">-</span> <span style="color:#a6e22e">Entry</span> <span style="color:#a6e22e">added</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">logfile</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">user</span> [{<span style="color:#ae81ff">1</span>}]<span style="color:#960050;background-color:#1e0010">&#34;</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">f</span> (<span style="color:#a6e22e">Get</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Date</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">Format</span> <span style="color:#a6e22e">T</span>), <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">UserPrincipalName</span>)
        }
    }
} <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">End</span> <span style="color:#a6e22e">User</span> <span style="color:#a6e22e">Processing</span>

<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">verbosePreference</span> = <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">SilentlyContinue</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
<span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">End</span></code></pre></td></tr></table>
</div>
</div></p>
</article>

  </section>
  <footer>
    
    
    
    <section class="author-info row">
      <div class="author-avatar col-md-2">
        
      </div>
      <div class="author-meta col-md-6">
        
        
      </div>
      
    </section>
    <ul class="pager">
      
      <li class="previous"><a href="https://bearman.nl/2016/06/22/the-castle-the-city-and-the-outlands/"><span aria-hidden="true">&larr;</span>Older</a></li>
      
      
      <li class="next"><a href="https://bearman.nl/2017/04/10/creators-update-1-remoteapp-and-desktop-connection-gateway-unavailable/">Newer<span aria-hidden="true">&rarr;</span></a></li>
      
    </ul>
  </footer>
</article>

</main>
<footer class="container global-footer">
  <div class="copyright-note pull-left">
    
  </div>
  <div class="sns-links hidden-print">
  
  
  
  
  
  
  
  
  
  
  
  
</div>
</footer>

<script src="https://bearman.nl/js/highlight.pack.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>


</body>

</html>